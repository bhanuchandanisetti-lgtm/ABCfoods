<!DOCTYPE html>
<html>
<head>
  <title>Dashboard - ABC Sea Foods</title>
  <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <style>
    .sidebar {
      min-height:100vh;
      background:#0d6efd;
      color:#fff;
      padding:1rem;
    }
    .product-card img {
      width:100%;
      height:120px;
      object-fit:cover;
      border-radius:.5rem;
    }
    .floating-cart {
      position:fixed;
      right:1rem;
      bottom:1rem;
      width:300px;
      max-height:50vh;
      overflow-y:auto;
      box-shadow:0 0 15px rgba(0,0,0,0.2);
      background:#fff;
      border-radius:.75rem;
      border:1px solid #ddd;
      padding:1rem;
    }
  </style>
</head>
<body class="bg-light">

<div class="container-fluid">
  <div class="row">

    <!-- Sidebar -->
    <div class="col-12 col-md-2 sidebar">
      <h5 class="text-white">{{ business_name }}</h5>
      <p class="text-white-50 mb-4">Welcome, {{ username }}</p>

      <ul class="nav flex-column">
        <li class="nav-item mb-2">
          <a class="nav-link text-white" href="{{ url_for('dashboard') }}">Dashboard / New Order</a>
        </li>

        <li class="nav-item mb-2">
          <a class="nav-link text-white" href="{{ url_for('orders_today') }}">Today's Orders</a>
        </li>

        <li class="nav-item mb-2">
          <a class="nav-link text-white" href="{{ url_for('products_page') }}">Products</a>
        </li>

        <li class="nav-item mb-2">
          <a class="nav-link text-white" href="{{ url_for('customers_page') }}">Customers</a>
        </li>

        <li class="nav-item mb-2">
          <span class="nav-link text-white-50">Reports (coming soon)</span>
        </li>

        <li class="nav-item mb-2">
          <a class="nav-link text-white" href="{{ url_for('logout') }}">Logout</a>
        </li>
      </ul>

      <hr class="border-light">
      <div class="text-white-50 small">
        <div>Today's Orders: {{ today_stats.order_count }}</div>
        <div>Today's Sales: ₹{{ "%.2f"|format(today_stats.total_sales) }}</div>
      </div>

    </div>

    <!-- Main content -->
    <div class="col-12 col-md-10 p-4">

      <!-- Customer picker + balance -->
      <div class="card mb-4 shadow-sm">
        <div class="card-body">
          <form method="POST" action="{{ url_for('set_customer_route') }}" class="row g-3 align-items-end">
            <div class="col-md-6">
              <label class="form-label fw-bold">Select Customer</label>
              <select class="form-select" name="customer_id" required>
                <option value="">-- choose --</option>
                {% for c in customers %}
                  <option value="{{ c.customer_id }}"
                    {% if active_customer_id and c.customer_id == active_customer_id %}selected{% endif %}>
                    {{ c.name }}
                  </option>
                {% endfor %}
              </select>
            </div>
            <div class="col-md-3">
              <button class="btn btn-primary w-100" type="submit">Set Customer</button>
            </div>
            <div class="col-md-3 text-end">
              {% if active_customer_balance is not none %}
                <div class="fw-bold">Balance: ₹{{ "%.2f"|format(active_customer_balance) }}</div>
              {% else %}
                <div class="text-muted small">Balance: --</div>
              {% endif %}
            </div>
          </form>
        </div>
      </div>

      <!-- Product grid -->
      {% if active_customer_id %}
        <div class="row g-4">
          {% for p in products %}
          <div class="col-12 col-sm-6 col-lg-4">
            <div class="card product-card shadow-sm">
              {% if p.image_path %}
                <img src="{{ url_for('static', filename=p.image_path.replace('static/','')) }}"
                     alt="{{ p.name }}">
              {% else %}
                <div class="bg-secondary text-white text-center p-5 rounded">No image</div>
              {% endif %}
              <div class="card-body">
                <h6 class="card-title">{{ p.name }}</h6>
                <div class="mb-2 text-muted small">{{ p.description }}</div>
                <div class="fw-bold mb-2">₹{{ "%.2f"|format(p.effective_price) }}</div>

                <form method="POST" action="{{ url_for('cart_add') }}" class="d-flex">
                  <input type="hidden" name="product_id" value="{{ p.product_id }}">
                  <input type="number" class="form-control me-2" name="qty" min="1" value="1" style="max-width:80px;">
                  <button class="btn btn-success w-100" type="submit">+ Add</button>
                </form>

              </div>
            </div>
          </div>
          {% endfor %}
        </div>
      {% else %}
        <div class="alert alert-warning">Select a customer above to load pricing and start an order.</div>
      {% endif %}

    </div>
  </div>
</div>

<!-- Floating cart -->
<div class="floating-cart">
  <h6 class="fw-bold mb-3">Current Order</h6>

  {% if cart|length == 0 %}
    <div class="text-muted small">No items yet.</div>
  {% else %}
    {% for item in cart %}
      <div class="d-flex justify-content-between">
        <div class="me-2">
          <div class="fw-bold">{{ item.name }}</div>
          <div class="small text-muted">
            {{ item.qty }} × ₹{{ "%.2f"|format(item.unit_price) }}
          </div>
        </div>
        <div class="text-end fw-bold">
          ₹{{ "%.2f"|format(item.line_total) }}
        </div>
      </div>
      <hr>
    {% endfor %}
    <div class="d-flex justify-content-between">
      <div class="fw-bold">Total</div>
      <div class="fw-bold">₹{{ "%.2f"|format(cart_total) }}</div>
    </div>
    <div class="mt-3">
      <a href="{{ url_for('cart_view') }}" class="btn btn-primary w-100">View / Confirm Order</a>
    </div>
  {% endif %}
</div>

</body>
</html>
